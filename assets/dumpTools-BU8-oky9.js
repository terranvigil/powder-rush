const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pass.fragment-Wtxh8pp8.js","assets/index-Dpjgymoa.js"])))=>i.map(i=>d[i]);
import{C as I,T as d,f as E,E as u,j as T,k as P}from"./index-Dpjgymoa.js";let l,m=null;async function S(){return m||(m=new Promise((t,r)=>{let n,e=null;const o={preserveDrawingBuffer:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};E(async()=>{const{ThinEngine:i}=await import("./index-Dpjgymoa.js").then(f=>f.t);return{ThinEngine:i}},[]).then(({ThinEngine:i})=>{const f=u.Instances.length;try{n=new OffscreenCanvas(100,100),e=new i(n,!1,o)}catch{f<u.Instances.length&&u.Instances.pop()?.dispose(),n=document.createElement("canvas"),e=new i(n,!1,o)}u.Instances.pop(),u.OnEnginesDisposedObservable.add(a=>{e&&a!==e&&!e.isDisposed&&u.Instances.length===0&&y()}),e.getCaps().parallelShaderCompile=void 0;const p=new T(e);E(async()=>{const{passPixelShader:a}=await import("./pass.fragment-Wtxh8pp8.js");return{passPixelShader:a}},__vite__mapDeps([0,1])).then(({passPixelShader:a})=>{if(!e){r("Engine is not defined");return}const s=new P({engine:e,name:a.name,fragmentShader:a.shader,samplerNames:["textureSampler"]});l={canvas:n,engine:e,renderer:p,wrapper:s},t(l)})}).catch(r)})),await m}async function _(t,r,n,e,o="image/png",i,f){const p=await n.readPixels(0,0,t,r),a=new Uint8Array(p.buffer);w(t,r,a,e,o,i,!0,void 0,f)}function v(t,r,n,e="image/png",o,i=!1,f=!1,p){return new Promise(a=>{w(t,r,n,s=>a(s),e,o,i,f,p)})}function w(t,r,n,e,o="image/png",i,f=!1,p=!1,a){S().then(s=>{if(s.engine.setSize(t,r,!0),n instanceof Float32Array){const g=new Uint8Array(n.length);let c=n.length;for(;c--;){const D=n[c];g[c]=Math.round(I(D)*255)}n=g}const h=s.engine.createRawTexture(n,t,r,5,!1,!f,1);s.renderer.setViewport(),s.renderer.applyEffectWrapper(s.wrapper),s.wrapper.effect._bindTexture("textureSampler",h),s.renderer.draw(),p?d.ToBlob(s.canvas,g=>{const c=new FileReader;c.onload=D=>{const A=D.target.result;e&&e(A)},c.readAsArrayBuffer(g)},o,a):d.EncodeScreenshotCanvasData(s.canvas,e,o,i,a),h.dispose()})}function y(){l?(l.wrapper.dispose(),l.renderer.dispose(),l.engine.dispose()):m?.then(t=>{t.wrapper.dispose(),t.renderer.dispose(),t.engine.dispose()}),m=null,l=null}const R={DumpData:w,DumpDataAsync:v,DumpFramebuffer:_,Dispose:y},x=()=>{d.DumpData=w,d.DumpDataAsync=v,d.DumpFramebuffer=_};x();export{y as Dispose,w as DumpData,v as DumpDataAsync,_ as DumpFramebuffer,R as DumpTools};
